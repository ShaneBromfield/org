#+title: Docker notes
#+author: ardumont

* Install

OS on ubuntu 12.04 or 13.10:
#+begin_src sh
# Install docker
curl -s https://get.docker.io/ubuntu/ | sudo sh
# Add the current user to docker group
sudo gpasswd -a $USER docker
# Unfortunately simply restart the docker service is not sufficient, I am forced to reboot the machine for the user to be able to use directly docker
sudo reboot
#+end_src

To check the installation is ok:

#+begin_src sh
sudo docker run -i -t ubuntu /bin/bash
#+end_src

* search

Search existing images in central index:
#+begin_src sh
docker search debian
#+end_src

* pull

#+begin_src sh
docker pull debian
#+end_src

* run

Run command in a container:
#+begin_src sh
CONTAINER_ID=$(docker run -d debian /bin/sh -c "echo hello")
#+end_src

* ps

Monitor the container:
#+begin_src sh
docker ps
#+end_src

Sample:
#+begin_src sh
$ docker ps
CONTAINER ID        IMAGE               COMMAND                CREATED             STATUS              PORTS               NAMES
ccc70474b671        ubuntu:12.04        /bin/sh -c while tru   3 minutes ago       Up 3 minutes                            condescending_Morse
#+end_src

* stop

Stop the container:
#+begin_src sh
docker stop $CONTAINER_ID
#+end_src

* kill

Kill a job:
#+begin_src sh
docker kill $CONTAINER_ID
#+end_src

* bind

Bind a service on a tcp port:
#+begin_src sh
# Bind port 4444 of this container, and tell netcat to listen on it
JOB=$(docker run -d -p 4444 ubuntu:12.10 /bin/nc -l 4444)

# Which public port is NATed to my container?
PORT=$(docker port $JOB 4444 | awk -F: '{ print $2 }')

# Connect to the public port
echo hello world | nc 127.0.0.1 $PORT

# Verify that the network connection worked
echo "Daemon received: $(sudo docker logs $JOB)"
#+end_src

* images

List the current known images:
#+begin_src sh
docker images
#+end_src

* commit

Save the current state of a container by commit:
#+begin_src sh
docker commit <container-id> <commit-message>
#+end_src

* Dockerfile

A Dockerfile is a simple text file which defines the instructions to be played from a given images.

Sample:
#+begin_src Dockerfile
from ubuntu:13.10
run echo "deb http://archive.ubuntu.com/ubuntu saucy main universe" > /etc/apt/sources.list
run apt-get update
run apt-get install -y memcached
#+end_src

Note:
- The `from` states from which images we should start the following actions.
- The `run` instructions are the equivalent commands of the run command `docker run...`
